2. Buffer

A Buffer is where data is stored when reading/writing via channels.

Buffers are typed: ByteBuffer, CharBuffer, IntBuffer, etc.

Has three key properties:

capacity â†’ max size

position â†’ current read/write index

limit â†’ boundary for read/write

Workflow:

Write data into buffer â†’ flip() â†’ Read data â†’ clear() or compact().

Example:

ByteBuffer buffer = ByteBuffer.allocate(1024);
int bytesRead = channel.read(buffer);  // read into buffer
buffer.flip(); // prepare to read
while(buffer.hasRemaining()) {
    System.out.print((char) buffer.get());
}
buffer.clear(); // ready for next read


//////////////////////////////////////////

Yes ğŸ‘ this is the most important part of understanding NIO Buffers. Letâ€™s visualize how the position, limit, and capacity move when we use flip() and rewind().

---------------------------------------------------
ğŸ”‘ Buffer Internals
Every buffer has 3 main pointers:
- capacity â†’ fixed size (how many bytes it can hold)
- position â†’ where the next read/write happens
- limit â†’ boundary (cannot read/write beyond this)

We imagine buffer as an array of slots with an arrow for position.
---------------------------------------------------

1) When writing into buffer
ByteBuffer buffer = ByteBuffer.allocate(8);
buffer.put((byte) 'A');
buffer.put((byte) 'B');
buffer.put((byte) 'C');

ğŸ“Š State after writing "ABC":
[ A ][ B ][ C ][   ][   ][   ][   ][   ]
              ^ position=3
limit=8
capacity=8

- Position moved forward as we wrote data.
- Limit is still at 8 (capacity).

---------------------------------------------------

2) After flip()
buffer.flip();

flip() does:
- limit = position (set new read boundary).
- position = 0 (go back to start for reading).

ğŸ“Š State:
[ A ][ B ][ C ][   ][   ][   ][   ][   ]
^ position=0
limit=3
capacity=8

ğŸ‘‰ Now we can read only 3 bytes (A, B, C).

---------------------------------------------------

3) Reading
System.out.println((char) buffer.get()); // A
System.out.println((char) buffer.get()); // B

ğŸ“Š State after 2 reads:
[ A ][ B ][ C ][   ][   ][   ][   ][   ]
                      ^ position=2
limit=3
capacity=8

---------------------------------------------------

4) rewind()
buffer.rewind();

rewind() does:
- Reset position = 0.
- limit stays the same.

ğŸ“Š State:
[ A ][ B ][ C ][   ][   ][   ][   ][   ]
^ position=0
limit=3
capacity=8

ğŸ‘‰ This allows us to re-read data from the buffer again (A, B, C) without rewriting into it.

---------------------------------------------------

5) clear()
buffer.clear();

clear() does:
- position = 0
- limit = capacity

ğŸ“Š State:
[ A ][ B ][ C ][   ][   ][   ][   ][   ]
^ position=0
limit=8
capacity=8

ğŸ‘‰ Looks like data is gone, but itâ€™s still there â€” just marked as â€œready to overwriteâ€.

---------------------------------------------------

âœ… Quick analogy:
- flip() = â€œI finished writing, now prepare to read what I wrote.â€
- rewind() = â€œGo back to the start of what I was reading/writing.â€
- clear() = â€œForget old data, get ready to write new data.â€

---------------------------------------------------
ğŸ“ Demo Program

import java.nio.ByteBuffer;

public class BufferFlipRewindDemo {
    public static void main(String[] args) {
        ByteBuffer buffer = ByteBuffer.allocate(8);

        // Step 1: Write into buffer
        buffer.put((byte) 'A');
        buffer.put((byte) 'B');
        buffer.put((byte) 'C');
        printState("After writing ABC", buffer);

        // Step 2: Flip
        buffer.flip();
        printState("After flip()", buffer);

        // Step 3: Read 2 chars
        System.out.println("Read: " + (char) buffer.get());
        System.out.println("Read: " + (char) buffer.get());
        printState("After reading 2 chars", buffer);

        // Step 4: Rewind
        buffer.rewind();
        printState("After rewind()", buffer);

        // Step 5: Clear
        buffer.clear();
        printState("After clear()", buffer);
    }

    private static void printState(String action, ByteBuffer buffer) {
        System.out.println("\n--- " + action + " ---");
        System.out.println("position=" + buffer.position()
                         + ", limit=" + buffer.limit()
                         + ", capacity=" + buffer.capacity());
    }
}

---------------------------------------------------
